SQL> 
SQL> 
SQL> -- vérification du type d'optimiseur
SQL>  show parameter optimizer_mode;

NAME                                 TYPE        VALUE                                                                                                                                                  
------------------------------------ ----------- ------------------------------                                                                                                                         
optimizer_mode                       string      ALL_ROWS                                                                                                                                               
SQL> 
SQL> -- optimizer_mode			     string	 ALL_ROWS
SQL> 
SQL> -- passer en mode all_rows si utile
SQL> set autotrace off
SQL> alter session set optimizer_mode=all_rows ;

Session modifiée.

SQL> 
SQL> -- calculer les statistiques sur les objets de l'utilisateur
SQL> -- &MYPDBUSER
SQL> execute dbms_stats.gather_schema_stats('&MYPDBUSER');

Procédure PL/SQL terminée avec succès.

SQL> 
SQL> -- Connexion avec au niveau CDB pour prendre un cliché AWR.
SQL> -- La gestion des statistiques se fait au niveau e ma CDB
SQL> connect &MYCDBUSER@&DBALIASCDB/&MYCDBUSERPASS
Connecté.
SQL> 
SQL> -- Prendre un premier cliché AWR pour délimiter
SQL> -- l'espace de récupération des requêtes.
SQL> set serveroutput on
SQL> variable snapid1 number;
SQL> 
SQL> begin
  2  	     :snapid1	     := dbms_workload_repository.create_snapshot;
  3  	     dbms_output.put_line('snap_id1='||:snapid1);
  4  end;
  5  /
snap_id1=85                                                                                                                                                                                             

Procédure PL/SQL terminée avec succès.

SQL> 
SQL> -- ReConnexion à la  PDB pour utiliser STA
SQL> connect &MYPDBUSER@&DBALIASPDB/&MYPDBUSERPASS
Connecté.
SQL> 
SQL> -- reporter le numéro de cliché rendu par le programme ici :
SQL> -- snap_id1=153  ? snap_id1=743
SQL> 
SQL> -- 2. Provoquer de l'activité (requêtes sur l'application bancaire)
SQL> -- dans la base entre deux clichés AWR
SQL> 
SQL> -- Désactiver l'affichage à l'écran des résultats des requêtes.
SQL>  set autotrace &TRACEOPTION
Entrez une valeur pour traceoption : TRACEONLY
SQL> 
SQL>  col adresse format a30
SQL> 
SQL> 
SQL>  -- Lancer plusieurs requêtes
SQL> 
SQL> -- REQUETES 1 TABLE
SQL> 
SQL> -- Compter le nombre d'immatriculations
SQL> select count(*) from immatriculation;


Plan d'exécution
----------------------------------------------------------                                                                                                                                              
Plan hash value: 3135058194                                                                                                                                                                             
                                                                                                                                                                                                        
--------------------------------------------------------------------------------------                                                                                                                  
| Id  | Operation             | Name                 | Rows  | Cost (%CPU)| Time     |                                                                                                                  
--------------------------------------------------------------------------------------                                                                                                                  
|   0 | SELECT STATEMENT      |                      |     1 |   208   (1)| 00:00:01 |                                                                                                                  
|   1 |  SORT AGGREGATE       |                      |     1 |            |          |                                                                                                                  
|   2 |   INDEX FAST FULL SCAN| PK_IMMATRICULATIONID |   197K|   208   (1)| 00:00:01 |                                                                                                                  
--------------------------------------------------------------------------------------                                                                                                                  


Statistiques
----------------------------------------------------------                                                                                                                                              
          2  recursive calls                                                                                                                                                                            
          2  db block gets                                                                                                                                                                              
        820  consistent gets                                                                                                                                                                            
          0  physical reads                                                                                                                                                                             
        184  redo size                                                                                                                                                                                  
        562  bytes sent via SQL*Net to client                                                                                                                                                           
        398  bytes received via SQL*Net from client                                                                                                                                                     
          2  SQL*Net roundtrips to/from client                                                                                                                                                          
          0  sorts (memory)                                                                                                                                                                             
          0  sorts (disk)                                                                                                                                                                               
          1  rows processed                                                                                                                                                                             

SQL> 
SQL> -- SÃ©lectionner tous les vÃ©hicules bleus du catalogue
SQL> select * from catalogue
  2  WHERE couleur = 'bleu';

53 lignes sélectionnées.


Plan d'exécution
----------------------------------------------------------                                                                                                                                              
Plan hash value: 2124023629                                                                                                                                                                             
                                                                                                                                                                                                        
-------------------------------------------------------------------------------                                                                                                                         
| Id  | Operation         | Name      | Rows  | Bytes | Cost (%CPU)| Time     |                                                                                                                         
-------------------------------------------------------------------------------                                                                                                                         
|   0 | SELECT STATEMENT  |           |    53 |  2756 |     3   (0)| 00:00:01 |                                                                                                                         
|*  1 |  TABLE ACCESS FULL| CATALOGUE |    53 |  2756 |     3   (0)| 00:00:01 |                                                                                                                         
-------------------------------------------------------------------------------                                                                                                                         
                                                                                                                                                                                                        
Predicate Information (identified by operation id):                                                                                                                                                     
---------------------------------------------------                                                                                                                                                     
                                                                                                                                                                                                        
   1 - filter("COULEUR"='bleu')                                                                                                                                                                         


Statistiques
----------------------------------------------------------                                                                                                                                              
         64  recursive calls                                                                                                                                                                            
          0  db block gets                                                                                                                                                                              
         34  consistent gets                                                                                                                                                                            
          0  physical reads                                                                                                                                                                             
          0  redo size                                                                                                                                                                                  
       3434  bytes sent via SQL*Net to client                                                                                                                                                           
        441  bytes received via SQL*Net from client                                                                                                                                                     
          5  SQL*Net roundtrips to/from client                                                                                                                                                          
          0  sorts (memory)                                                                                                                                                                             
          0  sorts (disk)                                                                                                                                                                               
         53  rows processed                                                                                                                                                                             

SQL> 
SQL> -- SÃ©lectionner les clients de plus de 50 ans
SQL> select * from client
  2  WHERE age > 50;

10052 lignes sélectionnées.


Plan d'exécution
----------------------------------------------------------                                                                                                                                              
Plan hash value: 3057461031                                                                                                                                                                             
                                                                                                                                                                                                        
----------------------------------------------------------------------------                                                                                                                            
| Id  | Operation         | Name   | Rows  | Bytes | Cost (%CPU)| Time     |                                                                                                                            
----------------------------------------------------------------------------                                                                                                                            
|   0 | SELECT STATEMENT  |        | 10052 |   431K|    69   (2)| 00:00:01 |                                                                                                                            
|*  1 |  TABLE ACCESS FULL| CLIENT | 10052 |   431K|    69   (2)| 00:00:01 |                                                                                                                            
----------------------------------------------------------------------------                                                                                                                            
                                                                                                                                                                                                        
Predicate Information (identified by operation id):                                                                                                                                                     
---------------------------------------------------                                                                                                                                                     
                                                                                                                                                                                                        
   1 - filter("AGE">50)                                                                                                                                                                                 


Statistiques
----------------------------------------------------------                                                                                                                                              
         36  recursive calls                                                                                                                                                                            
          0  db block gets                                                                                                                                                                              
        893  consistent gets                                                                                                                                                                            
          0  physical reads                                                                                                                                                                             
          0  redo size                                                                                                                                                                                  
     504257  bytes sent via SQL*Net to client                                                                                                                                                           
       7767  bytes received via SQL*Net from client                                                                                                                                                     
        672  SQL*Net roundtrips to/from client                                                                                                                                                          
          0  sorts (memory)                                                                                                                                                                             
          0  sorts (disk)                                                                                                                                                                               
      10052  rows processed                                                                                                                                                                             

SQL> 
SQL> -- SÃ©lectionner l'Ã¢ge et le sexe des personnes qui souhaitent s'acheter une deuxiÃ¨me voiture
SQL> select age, sexe from marketing
  2  WHERE deuxiemeVoiture = 'true';


Plan d'exécution
----------------------------------------------------------                                                                                                                                              
Plan hash value: 1777669847                                                                                                                                                                             
                                                                                                                                                                                                        
-------------------------------------------------------------------------------                                                                                                                         
| Id  | Operation         | Name      | Rows  | Bytes | Cost (%CPU)| Time     |                                                                                                                         
-------------------------------------------------------------------------------                                                                                                                         
|   0 | SELECT STATEMENT  |           |     1 |    11 |     3   (0)| 00:00:01 |                                                                                                                         
|*  1 |  TABLE ACCESS FULL| MARKETING |     1 |    11 |     3   (0)| 00:00:01 |                                                                                                                         
-------------------------------------------------------------------------------                                                                                                                         
                                                                                                                                                                                                        
Predicate Information (identified by operation id):                                                                                                                                                     
---------------------------------------------------                                                                                                                                                     
                                                                                                                                                                                                        
   1 - filter("DEUXIEMEVOITURE"='true')                                                                                                                                                                 


Statistiques
----------------------------------------------------------                                                                                                                                              
         24  recursive calls                                                                                                                                                                            
          0  db block gets                                                                                                                                                                              
         16  consistent gets                                                                                                                                                                            
          0  physical reads                                                                                                                                                                             
          0  redo size                                                                                                                                                                                  
        631  bytes sent via SQL*Net to client                                                                                                                                                           
        424  bytes received via SQL*Net from client                                                                                                                                                     
          2  SQL*Net roundtrips to/from client                                                                                                                                                          
          0  sorts (memory)                                                                                                                                                                             
          0  sorts (disk)                                                                                                                                                                               
          1  rows processed                                                                                                                                                                             

SQL> 
SQL> -- SÃ©lectionner le nom et le numÃ©ro d'immatriculation des voitures de la marque Audi
SQL> select nom, immatriculation from immatriculation
  2  WHERE marque = 'Audi';

43716 lignes sélectionnées.


Plan d'exécution
----------------------------------------------------------                                                                                                                                              
Plan hash value: 1374169303                                                                                                                                                                             
                                                                                                                                                                                                        
-------------------------------------------------------------------------------------                                                                                                                   
| Id  | Operation         | Name            | Rows  | Bytes | Cost (%CPU)| Time     |                                                                                                                   
-------------------------------------------------------------------------------------                                                                                                                   
|   0 | SELECT STATEMENT  |                 | 43716 |  1238K|   515   (1)| 00:00:01 |                                                                                                                   
|*  1 |  TABLE ACCESS FULL| IMMATRICULATION | 43716 |  1238K|   515   (1)| 00:00:01 |                                                                                                                   
-------------------------------------------------------------------------------------                                                                                                                   
                                                                                                                                                                                                        
Predicate Information (identified by operation id):                                                                                                                                                     
---------------------------------------------------                                                                                                                                                     
                                                                                                                                                                                                        
   1 - filter("MARQUE"='Audi')                                                                                                                                                                          


Statistiques
----------------------------------------------------------                                                                                                                                              
         15  recursive calls                                                                                                                                                                            
          0  db block gets                                                                                                                                                                              
       4680  consistent gets                                                                                                                                                                            
          0  physical reads                                                                                                                                                                             
          0  redo size                                                                                                                                                                                  
    1272899  bytes sent via SQL*Net to client                                                                                                                                                           
      32486  bytes received via SQL*Net from client                                                                                                                                                     
       2916  SQL*Net roundtrips to/from client                                                                                                                                                          
          0  sorts (memory)                                                                                                                                                                             
          0  sorts (disk)                                                                                                                                                                               
      43716  rows processed                                                                                                                                                                             

SQL> 
SQL> 
SQL> -- REQUETES 2 TABLES
SQL> 
SQL> -- SÃ©lectionner les vÃ©hicules du catalogue qui ont dÃ©jÃ  Ã©tÃ© immatriculÃ©s en tant que vÃ©hicules d'occasion
SQL> SELECT *
  2  FROM catalogue
  3  JOIN immatriculation
  4  ON catalogue.marque = immatriculation.marque
  5  WHERE immatriculation.occasion = 'VRAI';

1146260 lignes sélectionnées.


Plan d'exécution
----------------------------------------------------------                                                                                                                                              
Plan hash value: 1850348159                                                                                                                                                                             
                                                                                                                                                                                                        
--------------------------------------------------------------------------------------                                                                                                                  
| Id  | Operation          | Name            | Rows  | Bytes | Cost (%CPU)| Time     |                                                                                                                  
--------------------------------------------------------------------------------------                                                                                                                  
|   0 | SELECT STATEMENT   |                 |  1147K|   122M|   529   (3)| 00:00:01 |                                                                                                                  
|*  1 |  HASH JOIN         |                 |  1147K|   122M|   529   (3)| 00:00:01 |                                                                                                                  
|   2 |   TABLE ACCESS FULL| CATALOGUE       |   265 | 13780 |     3   (0)| 00:00:01 |                                                                                                                  
|*  3 |   TABLE ACCESS FULL| IMMATRICULATION | 60011 |  3516K|   517   (2)| 00:00:01 |                                                                                                                  
--------------------------------------------------------------------------------------                                                                                                                  
                                                                                                                                                                                                        
Predicate Information (identified by operation id):                                                                                                                                                     
---------------------------------------------------                                                                                                                                                     
                                                                                                                                                                                                        
   1 - access("CATALOGUE"."MARQUE"="IMMATRICULATION"."MARQUE")                                                                                                                                          
   3 - filter("IMMATRICULATION"."OCCASION"='VRAI')                                                                                                                                                      


Statistiques
----------------------------------------------------------                                                                                                                                              
        124  recursive calls                                                                                                                                                                            
          0  db block gets                                                                                                                                                                              
      10620  consistent gets                                                                                                                                                                            
          0  physical reads                                                                                                                                                                             
          0  redo size                                                                                                                                                                                  
   38327519  bytes sent via SQL*Net to client                                                                                                                                                           
     841078  bytes received via SQL*Net from client                                                                                                                                                     
      76419  SQL*Net roundtrips to/from client                                                                                                                                                          
          0  sorts (memory)                                                                                                                                                                             
          0  sorts (disk)                                                                                                                                                                               
    1146260  rows processed                                                                                                                                                                             

SQL> 
SQL> -- SÃ©lectionner les clients qui ont le mÃªme taux que les potentiels client qui veulent acheter une deuxiÃ¨me voiture
SQL> SELECT *
  2  FROM client
  3  JOIN marketing
  4  ON client.taux = marketing.taux
  5  WHERE marketing.deuxiemeVoiture = 'true';

29 lignes sélectionnées.


Plan d'exécution
----------------------------------------------------------                                                                                                                                              
Plan hash value: 1338212028                                                                                                                                                                             
                                                                                                                                                                                                        
--------------------------------------------------------------------------------                                                                                                                        
| Id  | Operation          | Name      | Rows  | Bytes | Cost (%CPU)| Time     |                                                                                                                        
--------------------------------------------------------------------------------                                                                                                                        
|   0 | SELECT STATEMENT   |           |    38 |  2850 |    72   (2)| 00:00:01 |                                                                                                                        
|*  1 |  HASH JOIN         |           |    38 |  2850 |    72   (2)| 00:00:01 |                                                                                                                        
|*  2 |   TABLE ACCESS FULL| MARKETING |     1 |    31 |     3   (0)| 00:00:01 |                                                                                                                        
|   3 |   TABLE ACCESS FULL| CLIENT    | 28728 |  1234K|    69   (2)| 00:00:01 |                                                                                                                        
--------------------------------------------------------------------------------                                                                                                                        
                                                                                                                                                                                                        
Predicate Information (identified by operation id):                                                                                                                                                     
---------------------------------------------------                                                                                                                                                     
                                                                                                                                                                                                        
   1 - access("CLIENT"."TAUX"="MARKETING"."TAUX")                                                                                                                                                       
   2 - filter("MARKETING"."DEUXIEMEVOITURE"='true')                                                                                                                                                     


Statistiques
----------------------------------------------------------                                                                                                                                              
         79  recursive calls                                                                                                                                                                            
          0  db block gets                                                                                                                                                                              
        255  consistent gets                                                                                                                                                                            
          0  physical reads                                                                                                                                                                             
          0  redo size                                                                                                                                                                                  
       3046  bytes sent via SQL*Net to client                                                                                                                                                           
        481  bytes received via SQL*Net from client                                                                                                                                                     
          3  SQL*Net roundtrips to/from client                                                                                                                                                          
          0  sorts (memory)                                                                                                                                                                             
          0  sorts (disk)                                                                                                                                                                               
         29  rows processed                                                                                                                                                                             

SQL> 
SQL> -- SÃ©lectionner les clients qui ont dÃ©jÃ  possÃ©dÃ© une Audi
SQL> SELECT *
  2  FROM client
  3  JOIN immatriculation
  4  ON client.immatriculation = immatriculation.immatriculation
  5  WHERE immatriculation.marque = 'Audi';

11461 lignes sélectionnées.


Plan d'exécution
----------------------------------------------------------                                                                                                                                              
Plan hash value: 2362199741                                                                                                                                                                             
                                                                                                                                                                                                        
--------------------------------------------------------------------------------------                                                                                                                  
| Id  | Operation          | Name            | Rows  | Bytes | Cost (%CPU)| Time     |                                                                                                                  
--------------------------------------------------------------------------------------                                                                                                                  
|   0 | SELECT STATEMENT   |                 | 28728 |  2917K|   585   (2)| 00:00:01 |                                                                                                                  
|*  1 |  HASH JOIN         |                 | 28728 |  2917K|   585   (2)| 00:00:01 |                                                                                                                  
|   2 |   TABLE ACCESS FULL| CLIENT          | 28728 |  1234K|    69   (2)| 00:00:01 |                                                                                                                  
|*  3 |   TABLE ACCESS FULL| IMMATRICULATION | 43716 |  2561K|   516   (1)| 00:00:01 |                                                                                                                  
--------------------------------------------------------------------------------------                                                                                                                  
                                                                                                                                                                                                        
Predicate Information (identified by operation id):                                                                                                                                                     
---------------------------------------------------                                                                                                                                                     
                                                                                                                                                                                                        
   1 - access("CLIENT"."IMMATRICULATION"="IMMATRICULATION"."IMMATRICULATION")                                                                                                                           
   3 - filter("IMMATRICULATION"."MARQUE"='Audi')                                                                                                                                                        
                                                                                                                                                                                                        
Note                                                                                                                                                                                                    
-----                                                                                                                                                                                                   
   - this is an adaptive plan                                                                                                                                                                           


Statistiques
----------------------------------------------------------                                                                                                                                              
         99  recursive calls                                                                                                                                                                            
          0  db block gets                                                                                                                                                                              
       2802  consistent gets                                                                                                                                                                            
          0  physical reads                                                                                                                                                                             
          0  redo size                                                                                                                                                                                  
     786225  bytes sent via SQL*Net to client                                                                                                                                                           
       8905  bytes received via SQL*Net from client                                                                                                                                                     
        766  SQL*Net roundtrips to/from client                                                                                                                                                          
          0  sorts (memory)                                                                                                                                                                             
          0  sorts (disk)                                                                                                                                                                               
      11461  rows processed                                                                                                                                                                             

SQL> 
SQL> -- SÃ©lectionner la couleur des voitures vendues Ã  des femmes
SQL> SELECT couleur
  2  FROM immatriculation
  3  JOIN client
  4  ON immatriculation.immatriculation = client.immatriculation
  5  WHERE client.sexe = 'F';

8629 lignes sélectionnées.


Plan d'exécution
----------------------------------------------------------                                                                                                                                              
Plan hash value: 2362199741                                                                                                                                                                             
                                                                                                                                                                                                        
--------------------------------------------------------------------------------------                                                                                                                  
| Id  | Operation          | Name            | Rows  | Bytes | Cost (%CPU)| Time     |                                                                                                                  
--------------------------------------------------------------------------------------                                                                                                                  
|   0 | SELECT STATEMENT   |                 |  8629 |   252K|   587   (2)| 00:00:01 |                                                                                                                  
|*  1 |  HASH JOIN         |                 |  8629 |   252K|   587   (2)| 00:00:01 |                                                                                                                  
|*  2 |   TABLE ACCESS FULL| CLIENT          |  8629 |   109K|    69   (2)| 00:00:01 |                                                                                                                  
|   3 |   TABLE ACCESS FULL| IMMATRICULATION |   197K|  3271K|   516   (1)| 00:00:01 |                                                                                                                  
--------------------------------------------------------------------------------------                                                                                                                  
                                                                                                                                                                                                        
Predicate Information (identified by operation id):                                                                                                                                                     
---------------------------------------------------                                                                                                                                                     
                                                                                                                                                                                                        
   1 - access("IMMATRICULATION"."IMMATRICULATION"="CLIENT"."IMMATRICULATION")                                                                                                                           
   2 - filter("CLIENT"."SEXE"='F')                                                                                                                                                                      
                                                                                                                                                                                                        
Note                                                                                                                                                                                                    
-----                                                                                                                                                                                                   
   - this is an adaptive plan                                                                                                                                                                           


Statistiques
----------------------------------------------------------                                                                                                                                              
         15  recursive calls                                                                                                                                                                            
          0  db block gets                                                                                                                                                                              
       2588  consistent gets                                                                                                                                                                            
          0  physical reads                                                                                                                                                                             
          0  redo size                                                                                                                                                                                  
     167312  bytes sent via SQL*Net to client                                                                                                                                                           
       6818  bytes received via SQL*Net from client                                                                                                                                                     
        577  SQL*Net roundtrips to/from client                                                                                                                                                          
          0  sorts (memory)                                                                                                                                                                             
          0  sorts (disk)                                                                                                                                                                               
       8629  rows processed                                                                                                                                                                             

SQL> 
SQL> -- SÃ©lcetionner le numÃ©ro d'immatriculation des voitures dont le modÃ¨le est Laguna 2.0T
SQL> SELECT immatriculation
  2  FROM immatriculation
  3  JOIN catalogue
  4  ON catalogue.nom = immatriculation.nom
  5  WHERE catalogue.nom='Laguna 2.0T';

111930 lignes sélectionnées.


Plan d'exécution
----------------------------------------------------------                                                                                                                                              
Plan hash value: 1850348159                                                                                                                                                                             
                                                                                                                                                                                                        
--------------------------------------------------------------------------------------                                                                                                                  
| Id  | Operation          | Name            | Rows  | Bytes | Cost (%CPU)| Time     |                                                                                                                  
--------------------------------------------------------------------------------------                                                                                                                  
|   0 | SELECT STATEMENT   |                 |   111K|  3607K|   519   (1)| 00:00:01 |                                                                                                                  
|*  1 |  HASH JOIN         |                 |   111K|  3607K|   519   (1)| 00:00:01 |                                                                                                                  
|*  2 |   TABLE ACCESS FULL| CATALOGUE       |    10 |   110 |     3   (0)| 00:00:01 |                                                                                                                  
|*  3 |   TABLE ACCESS FULL| IMMATRICULATION | 11193 |   240K|   516   (1)| 00:00:01 |                                                                                                                  
--------------------------------------------------------------------------------------                                                                                                                  
                                                                                                                                                                                                        
Predicate Information (identified by operation id):                                                                                                                                                     
---------------------------------------------------                                                                                                                                                     
                                                                                                                                                                                                        
   1 - access("CATALOGUE"."NOM"="IMMATRICULATION"."NOM")                                                                                                                                                
   2 - filter("CATALOGUE"."NOM"='Laguna 2.0T')                                                                                                                                                          
   3 - filter("IMMATRICULATION"."NOM"='Laguna 2.0T')                                                                                                                                                    


Statistiques
----------------------------------------------------------                                                                                                                                              
         19  recursive calls                                                                                                                                                                            
          0  db block gets                                                                                                                                                                              
       3054  consistent gets                                                                                                                                                                            
          0  physical reads                                                                                                                                                                             
          0  redo size                                                                                                                                                                                  
    2107195  bytes sent via SQL*Net to client                                                                                                                                                           
      82564  bytes received via SQL*Net from client                                                                                                                                                     
       7463  SQL*Net roundtrips to/from client                                                                                                                                                          
          0  sorts (memory)                                                                                                                                                                             
          0  sorts (disk)                                                                                                                                                                               
     111930  rows processed                                                                                                                                                                             

SQL> 
SQL> 
SQL> -- REQUETES 3 TABLES
SQL> 
SQL> SELECT DISTINCT marketing.taux
  2  FROM marketing
  3  JOIN client
  4  ON client.sexe = marketing.sexe
  5  JOIN immatriculation
  6  ON immatriculation.immatriculation = client.immatriculation
  7  WHERE immatriculation.marque = 'Audi';

9 lignes sélectionnées.


Plan d'exécution
----------------------------------------------------------                                                                                                                                              
Plan hash value: 376392015                                                                                                                                                                              
                                                                                                                                                                                                        
----------------------------------------------------------------------------------------                                                                                                                
| Id  | Operation            | Name            | Rows  | Bytes | Cost (%CPU)| Time     |                                                                                                                
----------------------------------------------------------------------------------------                                                                                                                
|   0 | SELECT STATEMENT     |                 |     9 |   333 |   598   (3)| 00:00:01 |                                                                                                                
|   1 |  HASH UNIQUE         |                 |     9 |   333 |   598   (3)| 00:00:01 |                                                                                                                
|*  2 |   HASH JOIN          |                 |   134K|  4872K|   589   (2)| 00:00:01 |                                                                                                                
|   3 |    TABLE ACCESS FULL | MARKETING       |     9 |    54 |     3   (0)| 00:00:01 |                                                                                                                
|*  4 |    HASH JOIN SEMI    |                 | 28728 |   869K|   585   (2)| 00:00:01 |                                                                                                                
|   5 |     TABLE ACCESS FULL| CLIENT          | 28728 |   364K|    69   (2)| 00:00:01 |                                                                                                                
|*  6 |     TABLE ACCESS FULL| IMMATRICULATION | 43716 |   768K|   515   (1)| 00:00:01 |                                                                                                                
----------------------------------------------------------------------------------------                                                                                                                
                                                                                                                                                                                                        
Predicate Information (identified by operation id):                                                                                                                                                     
---------------------------------------------------                                                                                                                                                     
                                                                                                                                                                                                        
   2 - access("CLIENT"."SEXE"="MARKETING"."SEXE")                                                                                                                                                       
   4 - access("IMMATRICULATION"."IMMATRICULATION"="CLIENT"."IMMATRICULATION")                                                                                                                           
   6 - filter("IMMATRICULATION"."MARQUE"='Audi')                                                                                                                                                        
                                                                                                                                                                                                        
Note                                                                                                                                                                                                    
-----                                                                                                                                                                                                   
   - this is an adaptive plan                                                                                                                                                                           


Statistiques
----------------------------------------------------------                                                                                                                                              
         29  recursive calls                                                                                                                                                                            
          0  db block gets                                                                                                                                                                              
       2030  consistent gets                                                                                                                                                                            
          0  physical reads                                                                                                                                                                             
          0  redo size                                                                                                                                                                                  
        675  bytes sent via SQL*Net to client                                                                                                                                                           
        570  bytes received via SQL*Net from client                                                                                                                                                     
          2  SQL*Net roundtrips to/from client                                                                                                                                                          
          0  sorts (memory)                                                                                                                                                                             
          0  sorts (disk)                                                                                                                                                                               
          9  rows processed                                                                                                                                                                             

SQL> 
SQL> SELECT DISTINCT catalogue.couleur
  2  FROM catalogue
  3  JOIN immatriculation
  4  ON  immatriculation.nom = catalogue.nom
  5  JOIN client
  6  ON client.immatriculation = immatriculation.immatriculation
  7  WHERE client.sexe='M';


Plan d'exécution
----------------------------------------------------------                                                                                                                                              
Plan hash value: 720261464                                                                                                                                                                              
                                                                                                                                                                                                        
------------------------------------------------------------------------------------------                                                                                                              
| Id  | Operation              | Name            | Rows  | Bytes | Cost (%CPU)| Time     |                                                                                                              
------------------------------------------------------------------------------------------                                                                                                              
|   0 | SELECT STATEMENT       |                 |     5 |   260 |   596   (3)| 00:00:01 |                                                                                                              
|   1 |  HASH UNIQUE           |                 |     5 |   260 |   596   (3)| 00:00:01 |                                                                                                              
|*  2 |   HASH JOIN            |                 | 82423 |  4185K|   590   (2)| 00:00:01 |                                                                                                              
|   3 |    VIEW                | VW_DTP_AE567E71 |   114 |  1938 |     4  (25)| 00:00:01 |                                                                                                              
|   4 |     HASH UNIQUE        |                 |   114 |  1938 |     4  (25)| 00:00:01 |                                                                                                              
|*  5 |      TABLE ACCESS FULL | CATALOGUE       |   265 |  4505 |     3   (0)| 00:00:01 |                                                                                                              
|*  6 |    HASH JOIN RIGHT SEMI|                 | 20029 |   684K|   585   (2)| 00:00:01 |                                                                                                              
|*  7 |     TABLE ACCESS FULL  | CLIENT          | 20065 |   254K|    69   (2)| 00:00:01 |                                                                                                              
|   8 |     TABLE ACCESS FULL  | IMMATRICULATION |   197K|  4233K|   515   (1)| 00:00:01 |                                                                                                              
------------------------------------------------------------------------------------------                                                                                                              
                                                                                                                                                                                                        
Predicate Information (identified by operation id):                                                                                                                                                     
---------------------------------------------------                                                                                                                                                     
                                                                                                                                                                                                        
   2 - access("IMMATRICULATION"."NOM"="ITEM_1")                                                                                                                                                         
   5 - filter("CATALOGUE"."NOM"='1007 1.4' OR "CATALOGUE"."NOM"='120i' OR                                                                                                                               
              "CATALOGUE"."NOM"='9.3 1.8T' OR "CATALOGUE"."NOM"='A2 1.4' OR                                                                                                                             
              "CATALOGUE"."NOM"='A200' OR "CATALOGUE"."NOM"='A3 2.0 FSI' OR                                                                                                                             
              "CATALOGUE"."NOM"='Almera 1.8' OR "CATALOGUE"."NOM"='Copper 1.6 16V' OR                                                                                                                   
              "CATALOGUE"."NOM"='Croma 2.2' OR "CATALOGUE"."NOM"='Cuore 1.0' OR                                                                                                                         
              "CATALOGUE"."NOM"='Espace 2.0T' OR "CATALOGUE"."NOM"='FR-V 1.7' OR                                                                                                                        
              "CATALOGUE"."NOM"='Golf 2.0 FSI' OR "CATALOGUE"."NOM"='Laguna 2.0T' OR                                                                                                                    
              "CATALOGUE"."NOM"='Logan 1.6 MPI' OR "CATALOGUE"."NOM"='M5' OR                                                                                                                            
              "CATALOGUE"."NOM"='Matrix 1.6' OR "CATALOGUE"."NOM"='Maxima 3.0 V6' OR                                                                                                                    
              "CATALOGUE"."NOM"='Megane 2.0 16V' OR "CATALOGUE"."NOM"='Mondeo 1.8' OR                                                                                                                   
              "CATALOGUE"."NOM"='New Beatle 1.8' OR "CATALOGUE"."NOM"='Picanto 1.1' OR                                                                                                                  
              "CATALOGUE"."NOM"='Polo 1.2 6V' OR "CATALOGUE"."NOM"='Primera 1.6' OR                                                                                                                     
              "CATALOGUE"."NOM"='S500' OR "CATALOGUE"."NOM"='S80 T6' OR                                                                                                                                 
              "CATALOGUE"."NOM"='Superb 2.8 V6' OR "CATALOGUE"."NOM"='Toledo 1.6' OR                                                                                                                    
              "CATALOGUE"."NOM"='Touran 2.0 FSI' OR "CATALOGUE"."NOM"='Vel Satis 3.5 V6' OR                                                                                                             
              "CATALOGUE"."NOM"='X-Type 2.5 V6' OR "CATALOGUE"."NOM"='Ypsilon 1.4 16V')                                                                                                                 
   6 - access("CLIENT"."IMMATRICULATION"="IMMATRICULATION"."IMMATRICULATION")                                                                                                                           
   7 - filter("CLIENT"."SEXE"='M')                                                                                                                                                                      


Statistiques
----------------------------------------------------------                                                                                                                                              
         93  recursive calls                                                                                                                                                                            
          0  db block gets                                                                                                                                                                              
       2048  consistent gets                                                                                                                                                                            
          0  physical reads                                                                                                                                                                             
          0  redo size                                                                                                                                                                                  
        649  bytes sent via SQL*Net to client                                                                                                                                                           
        565  bytes received via SQL*Net from client                                                                                                                                                     
          2  SQL*Net roundtrips to/from client                                                                                                                                                          
          0  sorts (memory)                                                                                                                                                                             
          0  sorts (disk)                                                                                                                                                                               
          5  rows processed                                                                                                                                                                             

SQL> 
SQL> SELECT  DISTINCT client.age
  2  FROM client
  3  JOIN immatriculation
  4  ON client.immatriculation=immatriculation.immatriculation
  5  JOIN catalogue
  6  ON catalogue.marque=immatriculation.marque
  7  WHERE catalogue.couleur = 'rouge';

68 lignes sélectionnées.


Plan d'exécution
----------------------------------------------------------                                                                                                                                              
Plan hash value: 3421959063                                                                                                                                                                             
                                                                                                                                                                                                        
-----------------------------------------------------------------------------------------                                                                                                               
| Id  | Operation             | Name            | Rows  | Bytes | Cost (%CPU)| Time     |                                                                                                               
-----------------------------------------------------------------------------------------                                                                                                               
|   0 | SELECT STATEMENT      |                 |    67 |  3082 |   591   (2)| 00:00:01 |                                                                                                               
|   1 |  HASH UNIQUE          |                 |    67 |  3082 |   591   (2)| 00:00:01 |                                                                                                               
|*  2 |   HASH JOIN RIGHT SEMI|                 | 28728 |  1290K|   588   (2)| 00:00:01 |                                                                                                               
|*  3 |    TABLE ACCESS FULL  | CATALOGUE       |    53 |   742 |     3   (0)| 00:00:01 |                                                                                                               
|*  4 |    HASH JOIN          |                 | 28728 |   897K|   585   (2)| 00:00:01 |                                                                                                               
|   5 |     TABLE ACCESS FULL | CLIENT          | 28728 |   392K|    69   (2)| 00:00:01 |                                                                                                               
|   6 |     TABLE ACCESS FULL | IMMATRICULATION |   197K|  3463K|   515   (1)| 00:00:01 |                                                                                                               
-----------------------------------------------------------------------------------------                                                                                                               
                                                                                                                                                                                                        
Predicate Information (identified by operation id):                                                                                                                                                     
---------------------------------------------------                                                                                                                                                     
                                                                                                                                                                                                        
   2 - access("CATALOGUE"."MARQUE"="IMMATRICULATION"."MARQUE")                                                                                                                                          
   3 - filter("CATALOGUE"."COULEUR"='rouge')                                                                                                                                                            
   4 - access("CLIENT"."IMMATRICULATION"="IMMATRICULATION"."IMMATRICULATION")                                                                                                                           
                                                                                                                                                                                                        
Note                                                                                                                                                                                                    
-----                                                                                                                                                                                                   
   - this is an adaptive plan                                                                                                                                                                           


Statistiques
----------------------------------------------------------                                                                                                                                              
         86  recursive calls                                                                                                                                                                            
          0  db block gets                                                                                                                                                                              
       2048  consistent gets                                                                                                                                                                            
          0  physical reads                                                                                                                                                                             
          0  redo size                                                                                                                                                                                  
       1703  bytes sent via SQL*Net to client                                                                                                                                                           
        616  bytes received via SQL*Net from client                                                                                                                                                     
          6  SQL*Net roundtrips to/from client                                                                                                                                                          
          0  sorts (memory)                                                                                                                                                                             
          0  sorts (disk)                                                                                                                                                                               
         68  rows processed                                                                                                                                                                             

SQL> 
SQL> SELECT DISTINCT immatriculation.puissance, immatriculation.marque
  2  FROM immatriculation
  3  JOIN catalogue
  4  ON immatriculation.marque = catalogue.marque
  5  JOIN client
  6  ON immatriculation.immatriculation = client.immatriculation
  7  WHERE immatriculation.puissance > 150
  8  ORDER BY client.age DESC;
ORDER BY client.age DESC
         *
ERREUR à la ligne 8 :
ORA-01791: cette expression n'a pas été SELECTionnée 


SQL> 
SQL> 
SQL> -- Voir la marque des voitures avec une puissante >150
SQL> SELECT DISTINCT immatriculation.puissance, immatriculation.marque
  2  FROM immatriculation
  3  JOIN catalogue
  4  ON immatriculation.marque = catalogue.marque
  5  JOIN client
  6  ON immatriculation.immatriculation = client.immatriculation
  7  WHERE immatriculation.puissance > 150
  8  ORDER BY immatriculation.puissance  DESC;


Plan d'exécution
----------------------------------------------------------                                                                                                                                              
Plan hash value: 2029005090                                                                                                                                                                             
                                                                                                                                                                                                        
------------------------------------------------------------------------------------------                                                                                                              
| Id  | Operation              | Name            | Rows  | Bytes | Cost (%CPU)| Time     |                                                                                                              
------------------------------------------------------------------------------------------                                                                                                              
|   0 | SELECT STATEMENT       |                 |    37 |  1517 |   899   (2)| 00:00:01 |                                                                                                              
|   1 |  SORT UNIQUE           |                 |    37 |  1517 |   896   (2)| 00:00:01 |                                                                                                              
|*  2 |   HASH JOIN RIGHT SEMI |                 | 28620 |  1145K|   589   (2)| 00:00:01 |                                                                                                              
|   3 |    TABLE ACCESS FULL   | CATALOGUE       |   265 |  2120 |     3   (0)| 00:00:01 |                                                                                                              
|*  4 |    HASH JOIN RIGHT SEMI|                 | 28620 |   922K|   585   (2)| 00:00:01 |                                                                                                              
|   5 |     TABLE ACCESS FULL  | CLIENT          | 28728 |   308K|    69   (2)| 00:00:01 |                                                                                                              
|*  6 |     TABLE ACCESS FULL  | IMMATRICULATION | 39292 |   844K|   516   (1)| 00:00:01 |                                                                                                              
------------------------------------------------------------------------------------------                                                                                                              
                                                                                                                                                                                                        
Predicate Information (identified by operation id):                                                                                                                                                     
---------------------------------------------------                                                                                                                                                     
                                                                                                                                                                                                        
   2 - access("IMMATRICULATION"."MARQUE"="CATALOGUE"."MARQUE")                                                                                                                                          
   4 - access("IMMATRICULATION"."IMMATRICULATION"="CLIENT"."IMMATRICULATION")                                                                                                                           
   6 - filter("IMMATRICULATION"."PUISSANCE">150)                                                                                                                                                        


Statistiques
----------------------------------------------------------                                                                                                                                              
        144  recursive calls                                                                                                                                                                            
         12  db block gets                                                                                                                                                                              
       2134  consistent gets                                                                                                                                                                            
          0  physical reads                                                                                                                                                                             
       1888  redo size                                                                                                                                                                                  
        708  bytes sent via SQL*Net to client                                                                                                                                                           
        667  bytes received via SQL*Net from client                                                                                                                                                     
          2  SQL*Net roundtrips to/from client                                                                                                                                                          
          8  sorts (memory)                                                                                                                                                                             
          0  sorts (disk)                                                                                                                                                                               
          2  rows processed                                                                                                                                                                             

SQL> 
SQL> 
SQL> -- REQUETES PLUS DE 3 TABLES
SQL> 
SQL> --Selectionner l'age de tous les conducteurs de Dacia.
SQL> SELECT DISTINCT marketing.age
  2  FROM marketing
  3  JOIN client
  4  ON client.sexe = marketing.sexe
  5  JOIN immatriculation
  6  ON client.immatriculation=immatriculation.immatriculation
  7  JOIN catalogue
  8  ON catalogue.puissance=immatriculation.puissance
  9  WHERE immatriculation.marque='Dacia'
 10  ORDER BY marketing.age DESC;


Plan d'exécution
----------------------------------------------------------                                                                                                                                              
Plan hash value: 2924402970                                                                                                                                                                             
                                                                                                                                                                                                        
-------------------------------------------------------------------------------------------                                                                                                             
| Id  | Operation               | Name            | Rows  | Bytes | Cost (%CPU)| Time     |                                                                                                             
-------------------------------------------------------------------------------------------                                                                                                             
|   0 | SELECT STATEMENT        |                 |     8 |   352 |   593   (2)| 00:00:01 |                                                                                                             
|   1 |  SORT UNIQUE            |                 |     8 |   352 |   592   (2)| 00:00:01 |                                                                                                             
|*  2 |   HASH JOIN             |                 |  9748 |   418K|   590   (1)| 00:00:01 |                                                                                                             
|   3 |    TABLE ACCESS FULL    | MARKETING       |     9 |    45 |     3   (0)| 00:00:01 |                                                                                                             
|*  4 |    HASH JOIN            |                 |  2077 | 81003 |   587   (1)| 00:00:01 |                                                                                                             
|*  5 |     HASH JOIN RIGHT SEMI|                 |  2069 | 53794 |   518   (1)| 00:00:01 |                                                                                                             
|   6 |      TABLE ACCESS FULL  | CATALOGUE       |   265 |  1060 |     3   (0)| 00:00:01 |                                                                                                             
|*  7 |      TABLE ACCESS FULL  | IMMATRICULATION |  2069 | 45518 |   515   (1)| 00:00:01 |                                                                                                             
|   8 |     TABLE ACCESS FULL   | CLIENT          | 28728 |   364K|    69   (2)| 00:00:01 |                                                                                                             
-------------------------------------------------------------------------------------------                                                                                                             
                                                                                                                                                                                                        
Predicate Information (identified by operation id):                                                                                                                                                     
---------------------------------------------------                                                                                                                                                     
                                                                                                                                                                                                        
   2 - access("CLIENT"."SEXE"="MARKETING"."SEXE")                                                                                                                                                       
   4 - access("CLIENT"."IMMATRICULATION"="IMMATRICULATION"."IMMATRICULATION")                                                                                                                           
   5 - access("CATALOGUE"."PUISSANCE"="IMMATRICULATION"."PUISSANCE")                                                                                                                                    
   7 - filter("IMMATRICULATION"."MARQUE"='Dacia')                                                                                                                                                       


Statistiques
----------------------------------------------------------                                                                                                                                              
        136  recursive calls                                                                                                                                                                            
          0  db block gets                                                                                                                                                                              
       2066  consistent gets                                                                                                                                                                            
          0  physical reads                                                                                                                                                                             
          0  redo size                                                                                                                                                                                  
        633  bytes sent via SQL*Net to client                                                                                                                                                           
        666  bytes received via SQL*Net from client                                                                                                                                                     
          2  SQL*Net roundtrips to/from client                                                                                                                                                          
          1  sorts (memory)                                                                                                                                                                             
          0  sorts (disk)                                                                                                                                                                               
          5  rows processed                                                                                                                                                                             

SQL> 
SQL> --Couleur de la voiture de tous les clients de la table marketing qui ont moins de 2 enfants.
SQL> SELECT DISTINCT catalogue.couleur
  2  FROM catalogue
  3  JOIN immatriculation
  4  ON catalogue.puissance=immatriculation.puissance
  5  JOIN client
  6  ON client.immatriculation=immatriculation.immatriculation
  7  JOIN marketing
  8  ON client.sexe = marketing.sexe
  9  WHERE marketing.nbEnfantsAcharge<2;


Plan d'exécution
----------------------------------------------------------                                                                                                                                              
Plan hash value: 1855452044                                                                                                                                                                             
                                                                                                                                                                                                        
-------------------------------------------------------------------------------------------                                                                                                             
| Id  | Operation               | Name            | Rows  | Bytes | Cost (%CPU)| Time     |                                                                                                             
-------------------------------------------------------------------------------------------                                                                                                             
|   0 | SELECT STATEMENT        |                 |     5 |   215 |   607   (4)| 00:00:01 |                                                                                                             
|   1 |  HASH UNIQUE            |                 |     5 |   215 |   607   (4)| 00:00:01 |                                                                                                             
|*  2 |   HASH JOIN             |                 |   198K|  8328K|   595   (2)| 00:00:01 |                                                                                                             
|   3 |    VIEW                 | VW_DTP_5F6F5A76 |    82 |   820 |     4  (25)| 00:00:01 |                                                                                                             
|   4 |     HASH UNIQUE         |                 |    82 |   820 |     4  (25)| 00:00:01 |                                                                                                             
|*  5 |      TABLE ACCESS FULL  | CATALOGUE       |   265 |  2650 |     3   (0)| 00:00:01 |                                                                                                             
|*  6 |    HASH JOIN            |                 | 28694 |   924K|   589   (2)| 00:00:01 |                                                                                                             
|*  7 |     HASH JOIN RIGHT SEMI|                 | 28694 |   504K|    72   (2)| 00:00:01 |                                                                                                             
|*  8 |      TABLE ACCESS FULL  | MARKETING       |     8 |    40 |     3   (0)| 00:00:01 |                                                                                                             
|   9 |      TABLE ACCESS FULL  | CLIENT          | 28728 |   364K|    69   (2)| 00:00:01 |                                                                                                             
|  10 |     TABLE ACCESS FULL   | IMMATRICULATION |   197K|  2886K|   515   (1)| 00:00:01 |                                                                                                             
-------------------------------------------------------------------------------------------                                                                                                             
                                                                                                                                                                                                        
Predicate Information (identified by operation id):                                                                                                                                                     
---------------------------------------------------                                                                                                                                                     
                                                                                                                                                                                                        
   2 - access("ITEM_1"="IMMATRICULATION"."PUISSANCE")                                                                                                                                                   
   5 - filter("CATALOGUE"."PUISSANCE">=55 AND "CATALOGUE"."PUISSANCE"<=507)                                                                                                                             
   6 - access("CLIENT"."IMMATRICULATION"="IMMATRICULATION"."IMMATRICULATION")                                                                                                                           
   7 - access("CLIENT"."SEXE"="MARKETING"."SEXE")                                                                                                                                                       
   8 - filter("MARKETING"."NBENFANTSACHARGE"<2)                                                                                                                                                         
                                                                                                                                                                                                        
Note                                                                                                                                                                                                    
-----                                                                                                                                                                                                   
   - this is an adaptive plan                                                                                                                                                                           


Statistiques
----------------------------------------------------------                                                                                                                                              
        171  recursive calls                                                                                                                                                                            
          5  db block gets                                                                                                                                                                              
       2078  consistent gets                                                                                                                                                                            
          0  physical reads                                                                                                                                                                             
        824  redo size                                                                                                                                                                                  
        649  bytes sent via SQL*Net to client                                                                                                                                                           
        640  bytes received via SQL*Net from client                                                                                                                                                     
          2  SQL*Net roundtrips to/from client                                                                                                                                                          
          0  sorts (memory)                                                                                                                                                                             
          0  sorts (disk)                                                                                                                                                                               
          5  rows processed                                                                                                                                                                             

SQL> 
SQL> 
SQL> --Afficher l'id, le taux et la situation familiale des clients qui possèdent une Dacia.
SQL> SELECT DISTINCT  marketing.clientMarketingId, marketing.taux, marketing.situationFamiliale
  2  FROM marketing
  3  JOIN client
  4  ON client.sexe = marketing.sexe
  5  JOIN immatriculation
  6  ON client.immatriculation=immatriculation.immatriculation
  7  JOIN catalogue
  8  ON catalogue.puissance=immatriculation.puissance
  9  WHERE immatriculation.marque='Dacia'
 10  ORDER BY marketing.clientMarketingId DESC;


Plan d'exécution
----------------------------------------------------------                                                                                                                                              
Plan hash value: 2924402970                                                                                                                                                                             
                                                                                                                                                                                                        
-------------------------------------------------------------------------------------------                                                                                                             
| Id  | Operation               | Name            | Rows  | Bytes | Cost (%CPU)| Time     |                                                                                                             
-------------------------------------------------------------------------------------------                                                                                                             
|   0 | SELECT STATEMENT        |                 |    81 |  4860 |   593   (2)| 00:00:01 |                                                                                                             
|   1 |  SORT UNIQUE            |                 |    81 |  4860 |   592   (2)| 00:00:01 |                                                                                                             
|*  2 |   HASH JOIN             |                 |  9748 |   571K|   590   (1)| 00:00:01 |                                                                                                             
|   3 |    TABLE ACCESS FULL    | MARKETING       |     9 |   189 |     3   (0)| 00:00:01 |                                                                                                             
|*  4 |    HASH JOIN            |                 |  2077 | 81003 |   587   (1)| 00:00:01 |                                                                                                             
|*  5 |     HASH JOIN RIGHT SEMI|                 |  2069 | 53794 |   518   (1)| 00:00:01 |                                                                                                             
|   6 |      TABLE ACCESS FULL  | CATALOGUE       |   265 |  1060 |     3   (0)| 00:00:01 |                                                                                                             
|*  7 |      TABLE ACCESS FULL  | IMMATRICULATION |  2069 | 45518 |   515   (1)| 00:00:01 |                                                                                                             
|   8 |     TABLE ACCESS FULL   | CLIENT          | 28728 |   364K|    69   (2)| 00:00:01 |                                                                                                             
-------------------------------------------------------------------------------------------                                                                                                             
                                                                                                                                                                                                        
Predicate Information (identified by operation id):                                                                                                                                                     
---------------------------------------------------                                                                                                                                                     
                                                                                                                                                                                                        
   2 - access("CLIENT"."SEXE"="MARKETING"."SEXE")                                                                                                                                                       
   4 - access("CLIENT"."IMMATRICULATION"="IMMATRICULATION"."IMMATRICULATION")                                                                                                                           
   5 - access("CATALOGUE"."PUISSANCE"="IMMATRICULATION"."PUISSANCE")                                                                                                                                    
   7 - filter("IMMATRICULATION"."MARQUE"='Dacia')                                                                                                                                                       


Statistiques
----------------------------------------------------------                                                                                                                                              
        138  recursive calls                                                                                                                                                                            
          5  db block gets                                                                                                                                                                              
       2068  consistent gets                                                                                                                                                                            
          0  physical reads                                                                                                                                                                             
        884  redo size                                                                                                                                                                                  
        875  bytes sent via SQL*Net to client                                                                                                                                                           
        741  bytes received via SQL*Net from client                                                                                                                                                     
          2  SQL*Net roundtrips to/from client                                                                                                                                                          
          1  sorts (memory)                                                                                                                                                                             
          0  sorts (disk)                                                                                                                                                                               
          5  rows processed                                                                                                                                                                             

SQL> 
SQL> -- Selectionner la marque de voiture que prend les clients qui ont comme situation familiale "En Couple".
SQL> SELECT DISTINCT immatriculation.marque
  2  FROM immatriculation
  3  JOIN catalogue
  4  ON immatriculation.marque = catalogue.marque
  5  JOIN client
  6  ON immatriculation.immatriculation = client.immatriculation
  7  JOIN marketing
  8  ON client.age = marketing.age
  9  WHERE marketing.situationFamiliale = 'En Couple';

12 lignes sélectionnées.


Plan d'exécution
----------------------------------------------------------                                                                                                                                              
Plan hash value: 742574618                                                                                                                                                                              
                                                                                                                                                                                                        
-----------------------------------------------------------------------------------------                                                                                                               
| Id  | Operation             | Name            | Rows  | Bytes | Cost (%CPU)| Time     |                                                                                                               
-----------------------------------------------------------------------------------------                                                                                                               
|   0 | SELECT STATEMENT      |                 |    17 |   935 |   592   (2)| 00:00:01 |                                                                                                               
|   1 |  HASH UNIQUE          |                 |    17 |   935 |   592   (2)| 00:00:01 |                                                                                                               
|*  2 |   HASH JOIN RIGHT SEMI|                 |  2073 |   111K|   591   (2)| 00:00:01 |                                                                                                               
|   3 |    TABLE ACCESS FULL  | CATALOGUE       |   265 |  2120 |     3   (0)| 00:00:01 |                                                                                                               
|*  4 |    HASH JOIN          |                 |  2073 | 97431 |   588   (2)| 00:00:01 |                                                                                                               
|*  5 |     HASH JOIN         |                 |  2073 | 60117 |    72   (2)| 00:00:01 |                                                                                                               
|*  6 |      TABLE ACCESS FULL| MARKETING       |     5 |    75 |     3   (0)| 00:00:01 |                                                                                                               
|   7 |      TABLE ACCESS FULL| CLIENT          | 28728 |   392K|    69   (2)| 00:00:01 |                                                                                                               
|   8 |     TABLE ACCESS FULL | IMMATRICULATION |   197K|  3463K|   515   (1)| 00:00:01 |                                                                                                               
-----------------------------------------------------------------------------------------                                                                                                               
                                                                                                                                                                                                        
Predicate Information (identified by operation id):                                                                                                                                                     
---------------------------------------------------                                                                                                                                                     
                                                                                                                                                                                                        
   2 - access("IMMATRICULATION"."MARQUE"="CATALOGUE"."MARQUE")                                                                                                                                          
   4 - access("IMMATRICULATION"."IMMATRICULATION"="CLIENT"."IMMATRICULATION")                                                                                                                           
   5 - access("CLIENT"."AGE"="MARKETING"."AGE")                                                                                                                                                         
   6 - filter("MARKETING"."SITUATIONFAMILIALE"='En Couple')                                                                                                                                             
                                                                                                                                                                                                        
Note                                                                                                                                                                                                    
-----                                                                                                                                                                                                   
   - this is an adaptive plan                                                                                                                                                                           


Statistiques
----------------------------------------------------------                                                                                                                                              
         85  recursive calls                                                                                                                                                                            
          0  db block gets                                                                                                                                                                              
       2052  consistent gets                                                                                                                                                                            
          0  physical reads                                                                                                                                                                             
          0  redo size                                                                                                                                                                                  
        735  bytes sent via SQL*Net to client                                                                                                                                                           
        655  bytes received via SQL*Net from client                                                                                                                                                     
          2  SQL*Net roundtrips to/from client                                                                                                                                                          
          0  sorts (memory)                                                                                                                                                                             
          0  sorts (disk)                                                                                                                                                                               
         12  rows processed                                                                                                                                                                             

SQL> 
SQL> --Afficher l'id du client, la marque et le prix du vehicule des clients de sexe féminin de la table marketing.
SQL> SELECT DISTINCT client.clientId, catalogue.marque, catalogue.prix
  2  FROM catalogue
  3  JOIN immatriculation
  4  ON catalogue.puissance=immatriculation.puissance
  5  JOIN client
  6  ON client.immatriculation=immatriculation.immatriculation
  7  JOIN marketing
  8  ON client.sexe = marketing.sexe
  9  WHERE marketing.sexe='F';

34367 lignes sélectionnées.


Plan d'exécution
----------------------------------------------------------                                                                                                                                              
Plan hash value: 213396178                                                                                                                                                                              
                                                                                                                                                                                                        
---------------------------------------------------------------------------------------------------                                                                                                     
| Id  | Operation               | Name            | Rows  | Bytes |TempSpc| Cost (%CPU)| Time     |                                                                                                     
---------------------------------------------------------------------------------------------------                                                                                                     
|   0 | SELECT STATEMENT        |                 |   142K|  7222K|       |  2434   (1)| 00:00:01 |                                                                                                     
|   1 |  HASH UNIQUE            |                 |   142K|  7222K|  8968K|  2434   (1)| 00:00:01 |                                                                                                     
|*  2 |   HASH JOIN             |                 |   142K|  7222K|       |   594   (2)| 00:00:01 |                                                                                                     
|   3 |    TABLE ACCESS FULL    | CATALOGUE       |   265 |  4505 |       |     3   (0)| 00:00:01 |                                                                                                     
|*  4 |    HASH JOIN            |                 |  7670 |   262K|       |   590   (2)| 00:00:01 |                                                                                                     
|*  5 |     HASH JOIN           |                 |  7670 |   149K|       |    73   (3)| 00:00:01 |                                                                                                     
|   6 |      VIEW               | VW_DTP_155B9617 |     1 |     2 |       |     4  (25)| 00:00:01 |                                                                                                     
|   7 |       HASH UNIQUE       |                 |     1 |     2 |       |     4  (25)| 00:00:01 |                                                                                                     
|*  8 |        TABLE ACCESS FULL| MARKETING       |     4 |     8 |       |     3   (0)| 00:00:01 |                                                                                                     
|   9 |      TABLE ACCESS FULL  | CLIENT          | 28728 |   504K|       |    69   (2)| 00:00:01 |                                                                                                     
|  10 |     TABLE ACCESS FULL   | IMMATRICULATION |   197K|  2886K|       |   515   (1)| 00:00:01 |                                                                                                     
---------------------------------------------------------------------------------------------------                                                                                                     
                                                                                                                                                                                                        
Predicate Information (identified by operation id):                                                                                                                                                     
---------------------------------------------------                                                                                                                                                     
                                                                                                                                                                                                        
   2 - access("CATALOGUE"."PUISSANCE"="IMMATRICULATION"."PUISSANCE")                                                                                                                                    
   4 - access("CLIENT"."IMMATRICULATION"="IMMATRICULATION"."IMMATRICULATION")                                                                                                                           
   5 - access("CLIENT"."SEXE"="ITEM_1")                                                                                                                                                                 
   8 - filter("MARKETING"."SEXE"='F')                                                                                                                                                                   
                                                                                                                                                                                                        
Note                                                                                                                                                                                                    
-----                                                                                                                                                                                                   
   - this is an adaptive plan                                                                                                                                                                           


Statistiques
----------------------------------------------------------                                                                                                                                              
        173  recursive calls                                                                                                                                                                            
         10  db block gets                                                                                                                                                                              
       2080  consistent gets                                                                                                                                                                            
          0  physical reads                                                                                                                                                                             
       1708  redo size                                                                                                                                                                                  
    1082398  bytes sent via SQL*Net to client                                                                                                                                                           
      25863  bytes received via SQL*Net from client                                                                                                                                                     
       2293  SQL*Net roundtrips to/from client                                                                                                                                                          
          0  sorts (memory)                                                                                                                                                                             
          0  sorts (disk)                                                                                                                                                                               
      34367  rows processed                                                                                                                                                                             

SQL> 
SQL> 
SQL>  set autotrace off
SQL> 
SQL> -- Connexion avec lau niveau CDB pour prendre un cliché AWR
SQL> -- La gestion des statistiques se fait au niveau e ma CDB
SQL> connect &MYCDBUSER@&DBALIASCDB/&MYCDBUSERPASS
Connecté.
SQL> 
SQL> 
SQL> -- Prendre un deuxième cliché AWR pour délimiter
SQL> -- la fin de l'espace de récupération des requêtes.
SQL> variable snapid2 number;
SQL> set serveroutput on
SQL> 
SQL> begin
  2  	     :snapid2	     := dbms_workload_repository.create_snapshot;
  3  	     dbms_output.put_line('snap_id2='||:snapid2);
  4  end;
  5  /
snap_id2=86                                                                                                                                                                                             

Procédure PL/SQL terminée avec succès.

SQL> 
SQL> -- ReConnexion à la  PDB pour utiliser STA
SQL> connect &MYPDBUSER@&DBALIASPDB/&MYPDBUSERPASS
Connecté.
SQL> 
SQL> -- reporter le numéro de cliché rendu par le programme ici :
SQL> -- snap_id2= 154 ? snap_id2=744
SQL> 
SQL> -- Supprimer la tache
SQL> -- Supprimer 1 tache BANK_SQL_TUNING_TASK si elle existe déjà
SQL> execute DBMS_SQLTUNE.DROP_TUNING_TASK('BANK_SQL_TUNING_TASK'||'&MYPDBUSER');
BEGIN DBMS_SQLTUNE.DROP_TUNING_TASK('BANK_SQL_TUNING_TASK'||'Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER'); END;

*
ERREUR à la ligne 1 :
ORA-13608: Le nom indiqué, BANK_SQL_TUNING_TASKProjet_..., n'est pas valide. 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 3062 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 7285 
ORA-06512: à "SYS.DBMS_SYS_ERROR", ligne 86 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 68 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 6145 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 7215 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 3046 
ORA-06512: à "SYS.DBMS_ADVISOR", ligne 193 
ORA-06512: à "SYS.DBMS_SQLTUNE", ligne 1289 
ORA-06512: à ligne 1 


SQL> execute DBMS_SQLTUNE.DROP_SQLSET('bank_sql_tuning_set'||'&MYPDBUSER');
BEGIN DBMS_SQLTUNE.DROP_SQLSET('bank_sql_tuning_set'||'Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER'); END;

*
ERREUR à la ligne 1 :
ORA-13755: le nom de l'"ensemble de réglages SQL" n'est pas valide 
ORA-06512: à "SYS.DBMS_SQLTUNE_UTIL1", ligne 437 
ORA-06512: à "SYS.DBMS_SQLTUNE", ligne 7309 
ORA-06512: à ligne 1 


SQL> -- Si vous avez déjà exécuté ce script, il se peut qu'un
SQL> -- qu'un profile de requête ai déjà été créé. Dans ce cas:
SQL> -- Rechercher puis supprimer le profie s'il existe déjà
SQL> ---
SQL> set linesize 200
SQL> col sql_text format A40
SQL> select name
  2  from dba_sql_profiles
  3  order by name;

aucune ligne sélectionnée

SQL> 
SQL> -- Supprimer le(s) profile(s) s'ils ont été trouvés avec la requête
SQL> -- précédente. NomProfile est le résultat de la requête
SQL> -- ci-dessus. Répéter l'action si utile.
SQL> execute DBMS_SQLTUNE.DROP_SQL_PROFILE('NomProfile');
BEGIN DBMS_SQLTUNE.DROP_SQL_PROFILE('NomProfile'); END;

*
ERREUR à la ligne 1 :
ORA-13833: le patch ou le profil SQL nommé NomProfile n'existe pas 
ORA-06512: à "SYS.DBMS_SQLTUNE_INTERNAL", ligne 18804 
ORA-06512: à "SYS.PRVT_SQLPROF_INFRA", ligne 48 
ORA-06512: à "SYS.DBMS_SQLTUNE", ligne 10999 
ORA-06512: à ligne 1 


SQL> 
SQL> -- 3. Générer les recommandations
SQL> -- Exécuter le script ci-dessous pour optimiser automatiquement
SQL> -- les requêtes lancées entre snap_id1 et snap_id2.
SQL> -- Le conseiller qui sera utilisé ici est SQL TUNNING ADVISOR.
SQL> set serveroutput on
SQL> DECLARE
  2  my_task_name VARCHAR2(30);
  3  nom_sqlset varchar2(50):='bank_sql_tuning_set'||'&MYPDBUSER';
  4  l_cursor  DBMS_SQLTUNE.sqlset_cursor;
  5  BEGIN
  6  DBMS_SQLTUNE.CREATE_SQLSET(
  7  sqlset_name => nom_sqlset,
  8  description => 'I/O intensive workload');
  9  
 10  -- Appel de la fonction DBMS_SQLTUNE.select_workload_repository
 11  -- pour recolter les requêtes à régler automatiquement entre
 12  -- snap_id1 et snap_id2.
 13  -- remplacer snap_id1 et snap_id2 par les valeurs capturées
 14  -- plus haut après les appels de:dbms_workload_repository.create_snapshot;.
 15  --1059 et 1174
 16    OPEN l_cursor FOR
 17  	 SELECT VALUE(p)
 18  	 FROM	TABLE (DBMS_SQLTUNE.select_workload_repository (
 19  			 :snapid1, --snap_id1,	-- begin_snap :
 20  			 :snapid2, --snap_id2,	-- end_snap
 21  			 'parsing_schema_name =''&MYPDBUSER''  and parsing_schema_name <> ''SYS''', -- basic_filter
 22  			 NULL, -- object_filter
 23  			 NULL, -- ranking_measure1
 24  			 NULL, -- ranking_measure2
 25  			 NULL, -- ranking_measure3
 26  			 NULL, -- result_percentage
 27  					     NULL, -- result_limit
 28  					     'ALL' -- attribute_list
 29  					     )
 30  		     --    10)	 -- result_limit
 31  		       ) p;
 32  
 33  -- charger les requêtes recoltées entre snap_id1 et snap_id2
 34  -- actuellement présente dans l_cursor dans le sql tuning
 35  -- set créé précédemment.
 36    DBMS_SQLTUNE.load_sqlset (
 37  	 sqlset_name	 => nom_sqlset,
 38  	 populate_cursor => l_cursor);
 39  
 40  -- créer une tâche de tuning pour le sql tuning set
 41  -- alimenté en requête dans l'action ci-dessus.
 42  my_task_name := DBMS_SQLTUNE.CREATE_TUNING_TASK(
 43  sqlset_name => nom_sqlset,
 44  basic_filter => 'parsing_schema_name =''&MYPDBUSER''', -- basic_filter
 45  scope => 'COMPREHENSIVE',
 46  time_limit => 60,
 47  task_name => 'BANK_SQL_TUNING_TASK'||'&MYPDBUSER',
 48  description => 'Task to tune a query on a specified bank queries'
 49  );
 50  
 51  -- Exécuter le tâche de tuning
 52  -- le conseiller utilisé ici est STA.
 53  DBMS_SQLTUNE.EXECUTE_TUNING_TASK( task_name => my_task_name );
 54  
 55  END;
 56  /
ancien   3 : nom_sqlset varchar2(50):='bank_sql_tuning_set'||'&MYPDBUSER';
nouveau   3 : nom_sqlset varchar2(50):='bank_sql_tuning_set'||'Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER';
ancien  21 :                     'parsing_schema_name =''&MYPDBUSER''  and parsing_schema_name <> ''SYS''', -- basic_filter
nouveau  21 :                     'parsing_schema_name =''Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER''  and parsing_schema_name <> ''SYS''', -- basic_filter
ancien  44 : basic_filter => 'parsing_schema_name =''&MYPDBUSER''', -- basic_filter
nouveau  44 : basic_filter => 'parsing_schema_name =''Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER''', -- basic_filter
ancien  47 : task_name => 'BANK_SQL_TUNING_TASK'||'&MYPDBUSER',
nouveau  47 : task_name => 'BANK_SQL_TUNING_TASK'||'Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER',
DECLARE
*
ERREUR à la ligne 1 :
ORA-06502: PL/SQL : erreur numérique ou erreur sur une valeur: tampon de chaîne de caractères trop petit 
ORA-06512: à ligne 3 


SQL> 
SQL> -- profile des fonctions utilisées dans le programme ci-dessus.
SQL> -- A ne pas exécuter. Voir le manuel Oracle Oracle® Database
SQL> -- PL/SQL Packages and Types Reference pour la description
SQL> -- détaillée.
SQL> /*
SQL> DBMS_SQLTUNE.SELECT_WORKLAOD_REPOSITORY (
SQL> begin_snap IN NUMBER,
SQL> end_snap IN NUMBER,
SQL> basic_filter IN VARCHAR2 := NULL,
SQL> object_filter IN VARCHAR2 := NULL,
SQL> ranking_measure1 IN VARCHAR2 := NULL,
SQL> ranking_measure2 IN VARCHAR2 := NULL,
SQL> ranking_measure3 IN VARCHAR2 := NULL,
SQL> result_percentage IN NUMBER := 1,
SQL> result_limit IN NUMBER := NULL
SQL> attribute_list IN VARCHAR2 := NULL)
SQL> RETURN sys.sqlset PIPELINED;
SQL> 
SQL> 
SQL> DBMS_SQLTUNE.CREATE_TUNING_TASK(
SQL> sqlset_name IN VARCHAR2,
SQL> basic_filter IN VARCHAR2 := NULL,
SQL> object_filter IN VARCHAR2 := NULL,
SQL> rank1 IN VARCHAR2 := NULL,
SQL> rank2 IN VARCHAR2 := NULL,
SQL> rank3 IN VARCHAR2 := NULL,
SQL> result_percentage IN NUMBER := NULL,
SQL> result_limit IN NUMBER := NULL,
SQL> scope IN VARCHAR2 := SCOPE_COMPREHENSIVE,
SQL> time_limit IN NUMBER := TIME_LIMIT_DEFAULT,
SQL> task_name IN VARCHAR2 := NULL,
SQL> description IN VARCHAR2 := NULL
SQL> plan_filter IN VARCHAR2 := 'MAX_ELAPSED_TIME',
SQL> sqlset_owner IN VARCHAR2 := NULL)
SQL> RETURN VARCHAR2;
SQL> 
SQL> */
SQL> 
SQL> 
SQL> 
SQL> -- 4. Afficher les résultats d'analyses
SQL> 
SQL> -- Consultation des informations sur la tache
SQL> 
SQL> -- Vérification de la tâche créée
SQL> col task_name format a20
SQL> SELECT task_name
  2  FROM DBA_ADVISOR_LOG
  3  WHERE owner ='ORS2' and task_name='BANK_SQL_TUNING_TASK'||'&MYPDBUSER';
ancien   3 : WHERE owner ='ORS2' and task_name='BANK_SQL_TUNING_TASK'||'&MYPDBUSER'
nouveau   3 : WHERE owner ='ORS2' and task_name='BANK_SQL_TUNING_TASK'||'Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER'

aucune ligne sélectionnée

SQL> 
SQL> --?
SQL> 
SQL> -- La vue Advisor_tasks contient des informations
SQL> -- sur les tâches
SQL> 
SQL> SELECT TASK_NAME, ADVISOR_NAME, status , RECOMMENDATION_COUNT, SOURCE
  2  FROM USER_ADVISOR_TASKS
  3  WHERE task_name = 'BANK_SQL_TUNING_TASK'||'&MYPDBUSER';
ancien   3 : WHERE task_name = 'BANK_SQL_TUNING_TASK'||'&MYPDBUSER'
nouveau   3 : WHERE task_name = 'BANK_SQL_TUNING_TASK'||'Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER'

aucune ligne sélectionnée

SQL> 
SQL> --?
SQL> 
SQL> -- La vue V$ADVISOR_PROGRESS contient des informations
SQL> -- sur la progression des tâches
SQL> 
SQL> -- Exemple de consultation de la progression
SQL> 
SQL> SELECT sofar, totalwork FROM
  2  V$ADVISOR_PROGRESS  vp,
  3  DBA_ADVISOR_LOG da
  4  WHERE vp.username = '&MYPDBUSER'
  5  AND vp.task_id=da.task_id
  6  AND da.task_name = 'BANK_SQL_TUNING_TASK'||'&MYPDBUSER';
ancien   4 : WHERE vp.username = '&MYPDBUSER'
nouveau   4 : WHERE vp.username = 'Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER'
ancien   6 : AND da.task_name = 'BANK_SQL_TUNING_TASK'||'&MYPDBUSER'
nouveau   6 : AND da.task_name = 'BANK_SQL_TUNING_TASK'||'Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER'

aucune ligne sélectionnée

SQL> 
SQL> --?
SQL> 
SQL> --La fonction DBMS_SQLTUNE.REPORT_TUNING_TASK permet d'afficher
SQL> --le résultat d'une analyse
SQL> 
SQL> 
SQL> SET LONG 4000
SQL> SET LONGCHUNKSIZE 4000
SQL> SET LINESIZE 200
SQL> SELECT DBMS_SQLTUNE.REPORT_TUNING_TASK( 'BANK_SQL_TUNING_TASK'||'&MYPDBUSER')
  2  FROM DUAL;
ancien   1 : SELECT DBMS_SQLTUNE.REPORT_TUNING_TASK( 'BANK_SQL_TUNING_TASK'||'&MYPDBUSER')
nouveau   1 : SELECT DBMS_SQLTUNE.REPORT_TUNING_TASK( 'BANK_SQL_TUNING_TASK'||'Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER')
ERROR:
ORA-13608: Le nom indiqué, BANK_SQL_TUNING_TASKProjet_..., n'est pas valide. 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 7285 
ORA-06512: à "SYS.DBMS_SYS_ERROR", ligne 86 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 68 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 6145 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 7215 
ORA-06512: à "SYS.DBMS_SQLTUNE", ligne 1359 
ORA-06512: à ligne 1 



aucune ligne sélectionnée

SQL> 
SQL> 
SQL> --?
SQL> 
SQL> -- résultat du report il est conseillée de restructurer la
SQL> -- requête.
SQL> 
SQL> --?
SQL> 
SQL> -- la ligne ci-dessous dans le rapport indique qu'il y'a une
SQL> -- restructuration de la requete à faire.
SQL> -- Number of SQL Restructure Findings: 1
SQL> 
SQL> --
SQL> -- Type de recommandation
SQL> -- Consulter le type de recommandation dans la vue
SQL> -- DBA_ADVISOR_RECOMMENDATIONS
SQL> --
SQL> 
SQL> col task_name format A20
SQL> col PARENT_REC_IDS format A40
SQL> col vs.SQL_TEXT format a60
SQL> col reco_type format A20
SQL> set linesize 200
SQL> set pagesize 400
SQL> 
SQL> 
SQL> select distinct dar.task_name,  vs.sql_id, vs.SQL_TEXT, dar.type reco_type  , BENEFIT
  2  from v$sqlarea vs,
  3  DBA_ADVISOR_SQLPLANS da,
  4  DBA_ADVISOR_RECOMMENDATIONS dar
  5  where vs.sql_id=da.sql_id
  6  and da.task_id=dar.task_id
  7  and dar.task_name='BANK_SQL_TUNING_TASK'||'&MYPDBUSER'
  8  and sql_text not like '%EXPLAIN%'
  9  and sql_text not like '%opt_param%'
 10  and sql_text not like '%insert%'
 11  and sql_text not like '%V_$SESSTAT%'
 12  and sql_text not like '%PLAN_TABLE%'
 13  order by dar.task_name,  vs.sql_id, reco_type;
ancien   7 : and dar.task_name='BANK_SQL_TUNING_TASK'||'&MYPDBUSER'
nouveau   7 : and dar.task_name='BANK_SQL_TUNING_TASK'||'Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER'

aucune ligne sélectionnée

SQL> 
SQL> 
SQL> --?
SQL> 
SQL> --
SQL> -- Consultation la description du problème trouvé par STA
SQL> -- Dans la vue DBA_ADVISOR_FINDINGS
SQL> -- Résultation de la recherche
SQL> ---
SQL> 
SQL> col task_name format A10
SQL> col message format A40
SQL> col more_info format A40
SQL> col impact_type format A40
SQL> col vs.SQL_TEXT format a40
SQL> set linesize 300
SQL> set pagesize 400
SQL> 
SQL> select distinct dar.task_name,  da.object_id, vs.sql_id, vs.SQL_TEXT, MESSAGE, impact_type, more_info
  2  from v$sqlarea vs,
  3  DBA_ADVISOR_SQLPLANS da,
  4  DBA_ADVISOR_FINDINGS dar
  5  where vs.sql_id=da.sql_id
  6  and da.task_id=dar.task_id
  7  and da.object_id=dar.object_id
  8  and dar.task_name='BANK_SQL_TUNING_TASK'||'&MYPDBUSER'
  9  and sql_text not like '%EXPLAIN%'
 10  and sql_text not like '%opt_param%'
 11  and sql_text not like '%insert%'
 12  and sql_text not like '%V_$SESSTAT%'
 13  and sql_text not like '%PLAN_TABLE%'
 14  order by dar.task_name,  da.object_id, vs.sql_id;
ancien   8 : and dar.task_name='BANK_SQL_TUNING_TASK'||'&MYPDBUSER'
nouveau   8 : and dar.task_name='BANK_SQL_TUNING_TASK'||'Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER'

aucune ligne sélectionnée

SQL> 
SQL> 
SQL> 
SQL> --?
SQL> 
SQL> ---
SQL> --- recommandation
SQL> --- consulter les actions (diagnostic) recommandées par STA
SQL> --- dans la vue DBA_ADVISOR_ACTIONS
SQL> ---
SQL> -- voir
SQL> col task_name format A20
SQL> col message format A40
SQL> col more_info format A40
SQL> col impact_type format A40
SQL> col SQL_TEXT format a40
SQL> 
SQL> set linesize 200
SQL> set pagesize 400
SQL> 
SQL> 
SQL> select distinct dar.task_name,  da.object_id, vs.sql_id, vs.SQL_TEXT, message
  2  from v$sqlarea vs,
  3  DBA_ADVISOR_SQLPLANS da,
  4  DBA_ADVISOR_ACTIONS dar
  5  where vs.sql_id=da.sql_id
  6  and da.task_id=dar.task_id
  7  and da.object_id=dar.object_id
  8  and dar.task_name='BANK_SQL_TUNING_TASK'||'&MYPDBUSER'
  9  and sql_text not like '%EXPLAIN%'
 10  and sql_text not like '%opt_param%'
 11  and sql_text not like '%insert%'
 12  and sql_text not like '%V_$SESSTAT%'
 13  and sql_text not like '%PLAN_TABLE%'
 14  order by dar.task_name, da.object_id, vs.sql_id;
ancien   8 : and dar.task_name='BANK_SQL_TUNING_TASK'||'&MYPDBUSER'
nouveau   8 : and dar.task_name='BANK_SQL_TUNING_TASK'||'Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER'

aucune ligne sélectionnée

SQL> 
SQL> --?
SQL> 
SQL> -- Liste des actions possibles
SQL> set linesize 200
SQL> col ATTR1 format a30
SQL> col ATTR2 format a10
SQL> col attr3 format a20
SQL> col ATTR4 format a10
SQL> col attr5 format a30
SQL> 
SQL> select
  2  object_id,
  3  ATTR1,
  4  ATTR2,
  5  ATTR3,
  6  ATTR4,
  7  ATTR5
  8  from DBA_ADVISOR_ACTIONS
  9  where attr1!='SYS'
 10  and attr1 not like '%SYSMAN%'
 11  order by object_id;

 OBJECT_ID ATTR1                          ATTR2      ATTR3                ATTR4      ATTR5                                                                                                              
---------- ------------------------------ ---------- -------------------- ---------- ------------------------------                                                                                     
         0 "ORS2"."TRANSACTION_IDX$$_001B            "ORS2"."TRANSACTION" BTREE      ("DATE_OPERATION")                                                                                                 
           0000"                                                                                                                                                                                        
                                                                                                                                                                                                        
         0 "ORS2"."TRANSACTION_IDX$$_001B            "ORS2"."TRANSACTION" BTREE      ("DATE_OPERATION")                                                                                                 
           0000"                                                                                                                                                                                        
                                                                                                                                                                                                        
         0 "ORS2"."TRANSACTION_IDX$$_001B            "ORS2"."TRANSACTION" BTREE      ("DATE_OPERATION")                                                                                                 
           0000"                                                                                                                                                                                        
                                                                                                                                                                                                        
         0 "ORS2"."PK_CLIENT_CLIENTID"               "ORS2"."CLIENT"      BTREE      ("CLIENTID")                                                                                                       
         0 "ORS2"."PK_CLIENT_CLIENTID"               "ORS2"."CLIENT"      BTREE      ("CLIENTID")                                                                                                       
         0 "ORS2"."PK_CLIENT_CLIENTID"               "ORS2"."CLIENT"      BTREE      ("CLIENTID")                                                                                                       
         0 "ORS2"."PK_CLIENT_CLIENTID"               "ORS2"."CLIENT"      BTREE      ("CLIENTID")                                                                                                       
         0 "ORS2"."TRANSACTION_IDX$$_001B            "ORS2"."TRANSACTION" BTREE      ("COMPTEID")                                                                                                       
           0003"                                                                                                                                                                                        
                                                                                                                                                                                                        
         0 "ORS2"."TRANSACTION_IDX$$_001B            "ORS2"."TRANSACTION" BTREE      ("COMPTEID")                                                                                                       
           0003"                                                                                                                                                                                        
                                                                                                                                                                                                        
         0 "ORS2"."TRANSACTION_IDX$$_001B            "ORS2"."TRANSACTION" BTREE      ("COMPTEID")                                                                                                       
           0003"                                                                                                                                                                                        
                                                                                                                                                                                                        
         0 "ORS2"."COMPTE_IDX$$_001B0002"            "ORS2"."COMPTE"      BTREE      ("CLIENTID")                                                                                                       
         0 "ORS2"."CLIENT_IDX$$_001B0001"            "ORS2"."CLIENT"      BTREE      ("NOM")                                                                                                            
         0 "ORS2"."COMPTE_IDX$$_001B0004"            "ORS2"."COMPTE"      BTREE      ("SOLDE")                                                                                                          
         0 "ORS2"."COMPTE_IDX$$_001B0004"            "ORS2"."COMPTE"      BTREE      ("SOLDE")                                                                                                          
         0 "ORS2"."PK_COMPTE_COMPTEID"               "ORS2"."COMPTE"      BTREE      ("COMPTEID")                                                                                                       
        27 alter table "ORS2"."ALLOBJECTS alter tabl alter table "ORS2"."                                                                                                                               
           2" shrink space                e "ORS2"." ALLOBJECTS2" enable                                                                                                                                
                                          ALLOBJECTS row movement                                                                                                                                       
                                          2" shrink                                                                                                                                                     
                                          space COMP                                                                                                                                                    
                                          ACT                                                                                                                                                           
                                                                                                                                                                                                        

16 lignes sélectionnées.

SQL> 
SQL> 
SQL> ---
SQL> --- Raisonnement
SQL> --- Raisonnement avec des explications complémentaires sur
SQL> --- le problème.
SQL> --- Consulté pour cela la vue DBA_ADVISOR_RATIONALE
SQL> ---
SQL> 
SQL> 
SQL> 
SQL> 
SQL> 
SQL> col task_name format A20
SQL> col message format A40
SQL> col more_info format A40
SQL> col impact_type format A40
SQL> col SQL_TEXT format a40
SQL> set linesize 200
SQL> set pagesize 400
SQL> 
SQL> 
SQL> select distinct dar.task_name,  da.object_id, vs.sql_id, vs.SQL_TEXT, message
  2  from v$sqlarea vs,
  3  DBA_ADVISOR_SQLPLANS da,
  4  DBA_ADVISOR_RATIONALE dar
  5  where vs.sql_id=da.sql_id
  6  and da.task_id=dar.task_id
  7  and da.object_id=dar.object_id
  8  and dar.task_name='BANK_SQL_TUNING_TASK'||'&MYPDBUSER'
  9  and sql_text not like '%EXPLAIN%'
 10  and sql_text not like '%opt_param%'
 11  and sql_text not like '%insert%'
 12  and sql_text not like '%V_$SESSTAT%'
 13  and sql_text not like '%PLAN_TABLE%'
 14  order by dar.task_name,  da.object_id, vs.sql_id;
ancien   8 : and dar.task_name='BANK_SQL_TUNING_TASK'||'&MYPDBUSER'
nouveau   8 : and dar.task_name='BANK_SQL_TUNING_TASK'||'Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER'

aucune ligne sélectionnée

SQL> --?
SQL> 
SQL> 
SQL> 
SQL> 
SQL> 
SQL> 
SQL> --
SQL> -- Rechercher s'il y'a des scripts générés
SQL> -- Identifier s'il ya un profile pour cette requête choisie plus
SQL> -- haut.
SQL> -- afficher le script complet ou partiel
SQL> col myscript format a1000
SQL> set long 4000
SQL> select dbms_sqltune.SCRIPT_TUNING_TASK('BANK_SQL_TUNING_TASK'||'&MYPDBUSER', 'ALL') MYSCRIPT from dual;
ancien   1 : select dbms_sqltune.SCRIPT_TUNING_TASK('BANK_SQL_TUNING_TASK'||'&MYPDBUSER', 'ALL') MYSCRIPT from dual
nouveau   1 : select dbms_sqltune.SCRIPT_TUNING_TASK('BANK_SQL_TUNING_TASK'||'Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER', 'ALL') MYSCRIPT from dual
ERROR:
ORA-13608: Le nom indiqué, BANK_SQL_TUNING_TASKProjet_..., n'est pas valide. 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 7285 
ORA-06512: à "SYS.DBMS_SYS_ERROR", ligne 86 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 68 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 6145 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 7215 
ORA-06512: à "SYS.DBMS_SQLTUNE", ligne 1806 
ORA-06512: à ligne 1 



aucune ligne sélectionnée

SQL> 
SQL> select dbms_sqltune.SCRIPT_TUNING_TASK('BANK_SQL_TUNING_TASK'||'&MYPDBUSER', 'INDEXES') MYSCRIPT from dual;
ancien   1 : select dbms_sqltune.SCRIPT_TUNING_TASK('BANK_SQL_TUNING_TASK'||'&MYPDBUSER', 'INDEXES') MYSCRIPT from dual
nouveau   1 : select dbms_sqltune.SCRIPT_TUNING_TASK('BANK_SQL_TUNING_TASK'||'Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER', 'INDEXES') MYSCRIPT from dual
ERROR:
ORA-13608: Le nom indiqué, BANK_SQL_TUNING_TASKProjet_..., n'est pas valide. 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 7285 
ORA-06512: à "SYS.DBMS_SYS_ERROR", ligne 86 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 68 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 6145 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 7215 
ORA-06512: à "SYS.DBMS_SQLTUNE", ligne 1806 
ORA-06512: à ligne 1 



aucune ligne sélectionnée

SQL> select dbms_sqltune.SCRIPT_TUNING_TASK('BANK_SQL_TUNING_TASK'||'&MYPDBUSER', 'PROFILES') MYSCRIPT from dual;
ancien   1 : select dbms_sqltune.SCRIPT_TUNING_TASK('BANK_SQL_TUNING_TASK'||'&MYPDBUSER', 'PROFILES') MYSCRIPT from dual
nouveau   1 : select dbms_sqltune.SCRIPT_TUNING_TASK('BANK_SQL_TUNING_TASK'||'Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER', 'PROFILES') MYSCRIPT from dual
ERROR:
ORA-13608: Le nom indiqué, BANK_SQL_TUNING_TASKProjet_..., n'est pas valide. 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 7285 
ORA-06512: à "SYS.DBMS_SYS_ERROR", ligne 86 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 68 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 6145 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 7215 
ORA-06512: à "SYS.DBMS_SQLTUNE", ligne 1806 
ORA-06512: à ligne 1 



aucune ligne sélectionnée

SQL> select dbms_sqltune.SCRIPT_TUNING_TASK('BANK_SQL_TUNING_TASK'||'&MYPDBUSER', 'STATISTICS') MYSCRIPT from dual;
ancien   1 : select dbms_sqltune.SCRIPT_TUNING_TASK('BANK_SQL_TUNING_TASK'||'&MYPDBUSER', 'STATISTICS') MYSCRIPT from dual
nouveau   1 : select dbms_sqltune.SCRIPT_TUNING_TASK('BANK_SQL_TUNING_TASK'||'Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER', 'STATISTICS') MYSCRIPT from dual
ERROR:
ORA-13608: Le nom indiqué, BANK_SQL_TUNING_TASKProjet_..., n'est pas valide. 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 7285 
ORA-06512: à "SYS.DBMS_SYS_ERROR", ligne 86 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 68 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 6145 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 7215 
ORA-06512: à "SYS.DBMS_SQLTUNE", ligne 1806 
ORA-06512: à ligne 1 



aucune ligne sélectionnée

SQL> 
SQL> -- une autre façon d'afficher le script complet
SQL> set serveroutput on
SQL> begin
  2  dbms_output.put_line(dbms_sqltune.SCRIPT_TUNING_TASK('BANK_SQL_TUNING_TASK'||'&MYPDBUSER', 'ALL'));
  3  end;
  4  /
ancien   2 : dbms_output.put_line(dbms_sqltune.SCRIPT_TUNING_TASK('BANK_SQL_TUNING_TASK'||'&MYPDBUSER', 'ALL'));
nouveau   2 : dbms_output.put_line(dbms_sqltune.SCRIPT_TUNING_TASK('BANK_SQL_TUNING_TASK'||'Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER', 'ALL'));
begin
*
ERREUR à la ligne 1 :
ORA-13608: Le nom indiqué, BANK_SQL_TUNING_TASKProjet_..., n'est pas valide. 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 7285 
ORA-06512: à "SYS.DBMS_SYS_ERROR", ligne 86 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 68 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 6145 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 7215 
ORA-06512: à "SYS.DBMS_SQLTUNE", ligne 1806 
ORA-06512: à ligne 2 


SQL> --?
SQL> 
SQL> -- 5. Gérer le script SQL proposé pour le réglage SQL
SQL> -- Gérer le script SQL proposé pour le réglage SQL : Attention ce script est disponible dans le dossier %ORACLE_BASE%\admin\dpdump
SQL> -- récupérer le script et le mettre dans votre dossier : EXO91
SQL> -- Editer ce script de façon approprié
SQL> declare
  2  mydate varchar2(20):=to_char(sysdate, 'DD_MM_YYYY_HH24_MI_SS');
  3  fname varchar2(300):='STA_Generate_action_script_on_projet_tuning'
  4  ||'&MYPDBUSER'|| '_'||mydate||'.sql';
  5  begin
  6  
  7  DBMS_ADVISOR.CREATE_FILE(
  8  DBMS_SQLTUNE.SCRIPT_TUNING_TASK('BANK_SQL_TUNING_TASK'||'&MYPDBUSER'),
  9  'DATA_PUMP_DIR',
 10  fname
 11  );
 12  end;
 13  /
ancien   4 : ||'&MYPDBUSER'|| '_'||mydate||'.sql';
nouveau   4 : ||'Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER'|| '_'||mydate||'.sql';
ancien   8 : DBMS_SQLTUNE.SCRIPT_TUNING_TASK('BANK_SQL_TUNING_TASK'||'&MYPDBUSER'),
nouveau   8 : DBMS_SQLTUNE.SCRIPT_TUNING_TASK('BANK_SQL_TUNING_TASK'||'Projet_TUNING_BDD_MOMAS_TAMANINI_FOURNIER'),
declare
*
ERREUR à la ligne 1 :
ORA-13608: Le nom indiqué, BANK_SQL_TUNING_TASKProjet_..., n'est pas valide. 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 7285 
ORA-06512: à "SYS.DBMS_SYS_ERROR", ligne 86 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 68 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 6145 
ORA-06512: à "SYS.PRVT_ADVISOR", ligne 7215 
ORA-06512: à "SYS.DBMS_SQLTUNE", ligne 1806 
ORA-06512: à ligne 7 


SQL> 
SQL> -- exécuter le script pour accepter le profile de la requête choisie
SQL> 
SQL> -- execute dbms_sqltune.accept_sql_profile(task_name => 'BANK_SQL_TUNING_TASK'||'&MYPDBUSER', replace => TRUE);
SQL> 
SQL> ---
SQL> --- Vérifier la présence d'un profie dans la vue
SQL> ---
SQL> set linesize 200
SQL> 
SQL> col sql_text format A40
SQL> select name ,CATEGORY,  SQL_TEXT , STATUS,FORCE_MATCHING
  2  from dba_sql_profiles
  3  order by name;

aucune ligne sélectionnée

SQL> 
SQL> 
SQL> SPOOL OFF
